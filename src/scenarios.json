{
	"listRule": [
		{
			"name": "👤 List My Users",
			"description": "List users - only admins can list all users",
			"config": {
				"authenticated": true,
				"extra": "@request.auth.role = 'admin'"
			}
		},
		{
			"name": "👥 List Teams I Belong To",
			"description": "List teams where the user is a member",
			"config": {
				"authenticated": true,
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= id"
			}
		},
		{
			"name": "📁 List Projects in My Teams",
			"description": "List projects for teams the user is a member of",
			"config": {
				"authenticated": true,
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= team"
			}
		},
		{
			"name": "✅ List Tasks in My Projects",
			"description": "List tasks for projects in teams the user is a member of",
			"config": {
				"authenticated": true,
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= project.team"
			}
		},
		{
			"name": "🔗 List My Team Memberships",
			"description": "List team_members records for the current user",
			"config": {
				"authenticated": true,
				"ownerField": "user"
			}
		}
	],
	"viewRule": [
		{
			"name": "👤 View User Profile",
			"description": "Users can view their own profile, admins can view any",
			"config": {
				"authenticated": true,
				"extra": "id = @request.auth.id OR @request.auth.role = 'admin'"
			}
		},
		{
			"name": "👥 View Team Details",
			"description": "Team members can view their team",
			"config": {
				"authenticated": true,
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= id"
			}
		},
		{
			"name": "📁 View Project",
			"description": "Project can be viewed by members of its team",
			"config": {
				"authenticated": true,
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= team"
			}
		},
		{
			"name": "✅ View Task",
			"description": "Tasks can be viewed by members of the parent project team",
			"config": {
				"authenticated": true,
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= project.team"
			}
		},
		{
			"name": "🔗 View My Team Membership",
			"description": "Users can view their own team_members records",
			"config": {
				"authenticated": true,
				"ownerField": "user"
			}
		}
	],
	"createRule": [
		{
			"name": "👤 Register User",
			"description": "Anyone can register a new user",
			"config": {
				"authenticated": false
			}
		},
		{
			"name": "👥 Create Team",
			"description": "Authenticated users can create teams",
			"config": {
				"authenticated": true
			}
		},
		{
			"name": "📁 Create Project",
			"description": "Only team members with 'can_create_projects' permission can create projects for a team",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.can_create_projects",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= @request.body.team"
			}
		},
		{
			"name": "✅ Create Task",
			"description": "Only project team members with 'can_create_tasks' can create tasks",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.can_create_tasks",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= project.team && project.id = @request.body.project"
			}
		},
		{
			"name": "🔗 Add Team Member",
			"description": "Only team admins can add team members",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.is_admin",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= @request.body.team"
			}
		}
	],
	"updateRule": [
		{
			"name": "👤 Update My Profile",
			"description": "Users can update their own profile",
			"config": {
				"authenticated": true,
				"ownerField": "id"
			}
		},
		{
			"name": "👥 Update Team",
			"description": "Only team admins can update team info",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.is_admin",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= id"
			}
		},
		{
			"name": "📁 Update Project",
			"description": "Only project team members with 'can_edit_projects' can update projects",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.can_edit_projects",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= team"
			}
		},
		{
			"name": "✅ Update Task",
			"description": "Only project team members with 'can_edit_tasks' can update tasks",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.can_edit_tasks",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= project.team && project.id = task.project"
			}
		},
		{
			"name": "🔗 Update Team Member Permissions",
			"description": "Only team admins can update team member permissions",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.is_admin",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= team"
			}
		}
	],
	"deleteRule": [
		{
			"name": "👤 Delete User (Admin Only)",
			"description": "Only admins can delete users",
			"config": {
				"authenticated": true,
				"extra": "@request.auth.role = 'admin'"
			}
		},
		{
			"name": "👥 Delete Team (Admin Only)",
			"description": "Only team admins can delete a team",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.is_admin",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= id"
			}
		},
		{
			"name": "📁 Delete Project",
			"description": "Only project team members with 'can_delete_projects' can delete projects",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.can_delete_projects",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@request.auth.id != \"\" && @collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= team && json_extract(@collection.team_members.permissions, '$.can_delete_projects') = true"
			}
		},
		{
			"name": "✅ Delete Task",
			"description": "Only project team members with 'can_delete_tasks' can delete tasks",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.can_delete_tasks",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@request.auth.id != \"\" && @collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= project.team && json_extract(@collection.team_members.permissions, '$.can_delete_tasks') = true"
			}
		},
		{
			"name": "🔗 Remove Team Member",
			"description": "Only team admins can remove team members",
			"config": {
				"authenticated": true,
				"abacConditions": [
					{
						"json": "@collection.team_members.permissions",
						"key": "$.is_admin",
						"val": "true",
						"operator": "and"
					}
				],
				"extra": "@collection.team_members.user ?= @request.auth.id && @collection.team_members.team ?= team"
			}
		}
	]
}
