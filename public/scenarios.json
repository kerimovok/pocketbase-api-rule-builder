{
  "listRule": [
    {
      "name": "üë§ List My Users",
      "description": "List users - only admins can list all users",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "@request.auth.role",
            "operator": "=",
            "operand2": "'admin'",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üë• List Teams I Belong To",
      "description": "List teams where the user is a member",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "id",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üìÅ List Projects in My Teams",
      "description": "List projects for teams the user is a member of",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "‚úÖ List Tasks in My Projects",
      "description": "List tasks for projects in teams the user is a member of",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "project.team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üîó List My Team Memberships",
      "description": "List team_members records for the current user",
      "config": {
        "authenticated": true,
        "ownerField": "user"
      }
    }
  ],
  "viewRule": [
    {
      "name": "üë§ View User Profile",
      "description": "Users can view their own profile, admins can view any",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "id",
            "operator": "=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@request.auth.role",
            "operator": "=",
            "operand2": "'admin'",
            "logic": "or"
          }
        ]
      }
    },
    {
      "name": "üë• View Team Details",
      "description": "Team members can view their team",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "id",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üìÅ View Project",
      "description": "Project can be viewed by members of its team",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "‚úÖ View Task",
      "description": "Tasks can be viewed by members of the parent project team",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "project.team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üîó View My Team Membership",
      "description": "Users can view their own team_members records",
      "config": {
        "authenticated": true,
        "ownerField": "user"
      }
    }
  ],
  "createRule": [
    {
      "name": "üë§ Register User",
      "description": "Anyone can register a new user",
      "config": {
        "authenticated": false
      }
    },
    {
      "name": "üë• Create Team",
      "description": "Authenticated users can create teams",
      "config": {
        "authenticated": true
      }
    },
    {
      "name": "üìÅ Create Project",
      "description": "Only team members with 'can_create_projects' permission can create projects for a team",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.can_create_projects",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "@request.body.team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "‚úÖ Create Task",
      "description": "Only project team members with 'can_create_tasks' can create tasks",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.can_create_tasks",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "project.team",
            "logic": "and"
          },
          {
            "operand1": "project.id",
            "operator": "=",
            "operand2": "@request.body.project",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üîó Add Team Member",
      "description": "Only team admins can add team members",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.is_admin",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "@request.body.team",
            "logic": "and"
          }
        ]
      }
    }
  ],
  "updateRule": [
    {
      "name": "üë§ Update My Profile",
      "description": "Users can update their own profile",
      "config": {
        "authenticated": true,
        "ownerField": "id"
      }
    },
    {
      "name": "üë• Update Team",
      "description": "Only team admins can update team info",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.is_admin",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "id",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üìÅ Update Project",
      "description": "Only project team members with 'can_edit_projects' can update projects",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.can_edit_projects",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "‚úÖ Update Task",
      "description": "Only project team members with 'can_edit_tasks' can update tasks",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.can_edit_tasks",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "project.team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üîó Update Team Member Permissions",
      "description": "Only team admins can update team member permissions",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.is_admin",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "team",
            "logic": "and"
          }
        ]
      }
    }
  ],
  "deleteRule": [
    {
      "name": "üë§ Delete User (Admin Only)",
      "description": "Only admins can delete users",
      "config": {
        "authenticated": true,
        "customConditions": [
          {
            "operand1": "@request.auth.role",
            "operator": "=",
            "operand2": "'admin'",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üë• Delete Team (Admin Only)",
      "description": "Only team admins can delete a team",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.is_admin",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "id",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üìÅ Delete Project",
      "description": "Only project team members with 'can_delete_projects' can delete projects",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.can_delete_projects",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "‚úÖ Delete Task",
      "description": "Only project team members with 'can_delete_tasks' can delete tasks",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.can_delete_tasks",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "project.team",
            "logic": "and"
          }
        ]
      }
    },
    {
      "name": "üîó Remove Team Member",
      "description": "Only team admins can remove team members",
      "config": {
        "authenticated": true,
        "abacConditions": [
          {
            "json": "@collection.team_members.permissions",
            "key": "$.is_admin",
            "val": "true",
            "operator": "and"
          }
        ],
        "customConditions": [
          {
            "operand1": "@collection.team_members.user",
            "operator": "?=",
            "operand2": "@request.auth.id",
            "logic": "and"
          },
          {
            "operand1": "@collection.team_members.team",
            "operator": "?=",
            "operand2": "team",
            "logic": "and"
          }
        ]
      }
    }
  ]
}
